<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Manage Guests - Hotel Senang Hati</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap" rel="stylesheet"> 

    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/optimized.css" rel="stylesheet">
</head>

<body>
    <!-- Spinner Start -->
    <div id="spinner" class="show w-100 vh-100 bg-white position-fixed translate-middle top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <!-- Spinner End -->

    <!-- Navbar start -->
    <div class="container-fluid fixed-top">
        <div class="container topbar bg-primary d-none d-lg-block">
            <div class="d-flex justify-content-between">
                <div class="top-info ps-2">
                    <small class="me-3"><i class="fas fa-map-marker-alt me-2 text-secondary"></i> <a href="#" class="text-white">Jl. Raya Senang No. 123, Jakarta</a></small>
                    <small class="me-3"><i class="fas fa-envelope me-2 text-secondary"></i><a href="#" class="text-white">info@hotelsenanghati.com</a></small>
                </div>
                <div class="top-link pe-2">
                    <a href="#" class="text-white"><small class="text-white mx-2">Privacy Policy</small>/</a>
                    <a href="#" class="text-white"><small class="text-white mx-2">Terms of Use</small>/</a>
                    <a href="#" class="text-white"><small class="text-white ms-2">Sales and Refunds</small></a>
                </div>
            </div>
        </div>
        <div class="container px-0">
            <nav class="navbar navbar-light bg-white navbar-expand-xl">
                <a href="index.html" class="navbar-brand"><h1 class="text-primary display-6">Hotel Senang Hati</h1></a>
                <button class="navbar-toggler py-2 px-3" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                    <span class="fa fa-bars text-primary"></span>
                </button>
                <div class="collapse navbar-collapse bg-white" id="navbarCollapse">
                    <div class="navbar-nav mx-auto">
                        <a href="index.html" class="nav-item nav-link">Home</a>
                        <a href="index.html" class="nav-item nav-link">Search Rooms</a>
                        <div class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Staff</a>
                            <div class="dropdown-menu m-0 bg-secondary rounded-0">
                                <a href="staff-dashboard.html" class="dropdown-item">Dashboard</a>
                                <a href="manage-reservations.html" class="dropdown-item">Reservations</a>
                                <a href="manage-rooms.html" class="dropdown-item">Rooms</a>
                                <a href="manage-guests.html" class="dropdown-item active">Guests</a>
                                <a href="reports.html" class="dropdown-item">Reports</a>
                            </div>
                        </div>
                        <a href="staff-login.html" class="nav-item nav-link">Staff Login</a>
                    </div>
                    <div class="d-flex m-3 me-0">
                        <button class="btn-search btn border border-secondary btn-md-square rounded-circle bg-white me-4" data-bs-toggle="modal" data-bs-target="#searchModal"><i class="fas fa-search text-primary"></i></button>
                        <a href="reservation-form.html" class="position-relative me-4 my-auto">
                            <i class="fa fa-calendar fa-2x"></i>
                        </a>
                        <a href="staff-login.html" class="my-auto">
                            <i class="fas fa-user fa-2x"></i>
                        </a>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    <!-- Navbar End -->

    <!-- Header Start -->
    <div class="container-fluid page-header py-5">
        <h1 class="text-center text-white display-6">Guest Management</h1>
        <ol class="breadcrumb justify-content-center mb-0">
            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
            <li class="breadcrumb-item"><a href="staff-dashboard.html">Staff Dashboard</a></li>
            <li class="breadcrumb-item active text-white">Manage Guests</li>
        </ol>
    </div>
    <!-- Header End -->

    <!-- Guest Management Start -->
    <div class="container-fluid py-5">
        <div class="container py-5">
            <div class="text-center mx-auto mb-5" style="max-width: 700px;">
                <h1 class="display-4">Guest Database Management</h1>
                <p>Manage guest profiles, preferences, and booking history for Hotel Senang Hati.</p>
            </div>

            <!-- Guest Management Controls -->
            <div class="row mb-4">
                <div class="col-lg-6">
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchGuests" placeholder="Search guests by name, email, or phone...">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                    </div>
                </div>
                <div class="col-lg-3">
                    <select class="form-select" id="filterGuestType">
                        <option value="">All Guest Types</option>
                        <option value="regular">Regular</option>
                        <option value="vip">VIP</option>
                        <option value="corporate">Corporate</option>
                        <option value="group">Group</option>
                    </select>
                </div>
                <div class="col-lg-3">
                    <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#addGuestModal">
                        <i class="fas fa-plus me-2"></i>Add New Guest
                    </button>
                </div>
            </div>

            <!-- Guest Statistics Cards -->
            <div class="row mb-5">
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="card border-left-primary shadow h-100">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total Guests</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalGuests">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-users fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="card border-left-success shadow h-100">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">VIP Guests</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="vipGuests">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-crown fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="card border-left-info shadow h-100">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Active Stays</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="activeStays">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-bed fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="card border-left-warning shadow h-100">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Returning Guests</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="returningGuests">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-heart fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guest List Table -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Guest Database</h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered" id="guestsTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Guest Type</th>
                                    <th>Total Stays</th>
                                    <th>Last Visit</th>
                                    <th>Loyalty Points</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="guestsTableBody">
                                <!-- Guests will be dynamically loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Guest Management End -->

    <!-- Add Guest Modal -->
    <div class="modal fade" id="addGuestModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Guest</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addGuestForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="firstName" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="firstName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="lastName" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label">Phone</label>
                                <input type="tel" class="form-control" id="phone" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="guestType" class="form-label">Guest Type</label>
                                <select class="form-select" id="guestType" required>
                                    <option value="">Select Type</option>
                                    <option value="regular">Regular</option>
                                    <option value="vip">VIP</option>
                                    <option value="corporate">Corporate</option>
                                    <option value="group">Group</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="nationality" class="form-label">Nationality</label>
                                <input type="text" class="form-control" id="nationality">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="dateOfBirth" class="form-label">Date of Birth</label>
                                <input type="date" class="form-control" id="dateOfBirth">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="idNumber" class="form-label">ID Number</label>
                                <input type="text" class="form-control" id="idNumber">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="address" class="form-label">Address</label>
                            <textarea class="form-control" id="address" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="preferences" class="form-label">Preferences</label>
                            <textarea class="form-control" id="preferences" rows="2" placeholder="Room type, dietary restrictions, special requests..."></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="notes" class="form-label">Notes</label>
                            <textarea class="form-control" id="notes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addGuest()">Add Guest</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Guest Modal -->
    <div class="modal fade" id="viewGuestModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Guest Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-primary">Personal Information</h6>
                            <table class="table table-borderless">
                                <tr><td><strong>Name:</strong></td><td id="viewGuestName"></td></tr>
                                <tr><td><strong>Email:</strong></td><td id="viewGuestEmail"></td></tr>
                                <tr><td><strong>Phone:</strong></td><td id="viewGuestPhone"></td></tr>
                                <tr><td><strong>Guest Type:</strong></td><td id="viewGuestType"></td></tr>
                                <tr><td><strong>Nationality:</strong></td><td id="viewGuestNationality"></td></tr>
                                <tr><td><strong>Date of Birth:</strong></td><td id="viewGuestDOB"></td></tr>
                                <tr><td><strong>ID Number:</strong></td><td id="viewGuestID"></td></tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-primary">Guest Statistics</h6>
                            <table class="table table-borderless">
                                <tr><td><strong>Total Stays:</strong></td><td id="viewGuestStays"></td></tr>
                                <tr><td><strong>Loyalty Points:</strong></td><td id="viewGuestPoints"></td></tr>
                                <tr><td><strong>Total Spent:</strong></td><td id="viewGuestSpent"></td></tr>
                                <tr><td><strong>First Visit:</strong></td><td id="viewGuestFirstVisit"></td></tr>
                                <tr><td><strong>Last Visit:</strong></td><td id="viewGuestLastVisit"></td></tr>
                            </table>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6 class="text-primary">Address</h6>
                            <p id="viewGuestAddress"></p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-primary">Preferences</h6>
                            <p id="viewGuestPreferences"></p>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-primary">Notes</h6>
                            <p id="viewGuestNotes"></p>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6 class="text-primary">Booking History</h6>
                            <div id="guestBookingHistory">
                                <!-- Booking history will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="editGuest()">Edit Guest</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Start -->
    <div class="container-fluid bg-dark text-white-50 footer pt-5 mt-5">
        <div class="container py-5">
            <div class="pb-4 mb-4" style="border-bottom: 1px solid rgba(226, 175, 24, 0.5) ;">
                <div class="row g-4">
                    <div class="col-lg-3">
                        <a href="#">
                            <h1 class="text-primary mb-0">Hotel Senang Hati</h1>
                            <p class="text-secondary mb-0">Luxury & Comfort</p>
                        </a>
                    </div>
                    <div class="col-lg-6">
                        <div class="position-relative mx-auto">
                            <input class="form-control border-0 w-100 py-3 px-4 rounded-pill" type="number" placeholder="Your Email">
                            <button type="submit" class="btn btn-primary border-0 border-secondary py-3 px-4 position-absolute rounded-pill text-white" style="top: 0; right: 0;">Subscribe Now</button>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="d-flex justify-content-end pt-3">
                            <a class="btn btn-outline-secondary me-2 btn-md-square rounded-circle" href=""><i class="fab fa-twitter"></i></a>
                            <a class="btn btn-outline-secondary me-2 btn-md-square rounded-circle" href=""><i class="fab fa-facebook-f"></i></a>
                            <a class="btn btn-outline-secondary me-2 btn-md-square rounded-circle" href=""><i class="fab fa-youtube"></i></a>
                            <a class="btn btn-outline-secondary btn-md-square rounded-circle" href=""><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row g-5">
                <div class="col-lg-3 col-md-6">
                    <div class="footer-item">
                        <h4 class="text-light mb-3">Why People Like us!</h4>
                        <p class="mb-4">Experience luxury and comfort at Hotel Senang Hati. Our dedicated staff ensures your stay is memorable.</p>
                        <a href="" class="btn border-secondary py-2 px-4 rounded-pill text-primary">Read More</a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="d-flex flex-column text-start footer-item">
                        <h4 class="text-light mb-3">Hotel Info</h4>
                        <a class="btn-link" href="">About Us</a>
                        <a class="btn-link" href="">Contact Us</a>
                        <a class="btn-link" href="">Privacy Policy</a>
                        <a class="btn-link" href="">Terms & Condition</a>
                        <a class="btn-link" href="">Return Policy</a>
                        <a class="btn-link" href="">FAQs & Help</a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="d-flex flex-column text-start footer-item">
                        <h4 class="text-light mb-3">Account</h4>
                        <a class="btn-link" href="">My Account</a>
                        <a class="btn-link" href="">Shop details</a>
                        <a class="btn-link" href="">Shopping Cart</a>
                        <a class="btn-link" href="">Wishlist</a>
                        <a class="btn-link" href="">Order History</a>
                        <a class="btn-link" href="">International Orders</a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="footer-item">
                        <h4 class="text-light mb-3">Contact</h4>
                        <p>Address: Jl. Raya Senang No. 123, Jakarta</p>
                        <p>Email: info@hotelsenanghati.com</p>
                        <p>Phone: +62 21 1234 5678</p>
                        <p>Payment Accepted</p>
                        <img src="img/payment.png" class="img-fluid" alt="">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-primary border-3 border-primary rounded-circle back-to-top"><i class="fa fa-arrow-up"></i></a>   

    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>
    <script src="js/hotel-system.js"></script>

    <script>
        // Guest Management functionality
        document.addEventListener('DOMContentLoaded', function() {
            loadGuestData();
            initializeGuestManagement();
        });

        function loadGuestData() {
            // Sample guest data - in real implementation, this would come from a database
            const sampleGuests = [
                {
                    id: 1,
                    firstName: 'John',
                    lastName: 'Doe',
                    email: 'john.doe@email.com',
                    phone: '+62 812 3456 7890',
                    guestType: 'vip',
                    nationality: 'Indonesia',
                    dateOfBirth: '1985-05-15',
                    idNumber: 'ID123456789',
                    address: 'Jl. Sudirman No. 45, Jakarta',
                    preferences: 'Non-smoking room, Late checkout',
                    notes: 'Frequent business traveler',
                    totalStays: 15,
                    loyaltyPoints: 2500,
                    totalSpent: 25000000,
                    firstVisit: '2020-03-15',
                    lastVisit: '2024-12-20',
                    registrationDate: '2020-03-15'
                },
                {
                    id: 2,
                    firstName: 'Sarah',
                    lastName: 'Wilson',
                    email: 'sarah.wilson@email.com',
                    phone: '+62 813 9876 5432',
                    guestType: 'regular',
                    nationality: 'Australia',
                    dateOfBirth: '1990-08-22',
                    idNumber: 'ID987654321',
                    address: 'Melbourne, Australia',
                    preferences: 'Vegetarian meals, Quiet room',
                    notes: 'Anniversary celebration',
                    totalStays: 3,
                    loyaltyPoints: 450,
                    totalSpent: 4500000,
                    firstVisit: '2023-06-10',
                    lastVisit: '2024-11-15',
                    registrationDate: '2023-06-10'
                },
                {
                    id: 3,
                    firstName: 'Ahmad',
                    lastName: 'Rahman',
                    email: 'ahmad.rahman@company.com',
                    phone: '+62 821 1111 2222',
                    guestType: 'corporate',
                    nationality: 'Indonesia',
                    dateOfBirth: '1982-12-03',
                    idNumber: 'ID555666777',
                    address: 'Jl. Thamrin No. 88, Jakarta',
                    preferences: 'Executive floor, Business center access',
                    notes: 'Corporate account - PT Maju Jaya',
                    totalStays: 8,
                    loyaltyPoints: 1200,
                    totalSpent: 12000000,
                    firstVisit: '2022-01-20',
                    lastVisit: '2024-10-30',
                    registrationDate: '2022-01-20'
                }
            ];

            // Store in localStorage if not exists
            if (!localStorage.getItem('hotelGuests')) {
                localStorage.setItem('hotelGuests', JSON.stringify(sampleGuests));
            }

            renderGuestsTable();
            updateGuestStatistics();
        }

        function renderGuestsTable() {
            const guests = JSON.parse(localStorage.getItem('hotelGuests') || '[]');
            const tbody = document.getElementById('guestsTableBody');
            
            tbody.innerHTML = guests.map(guest => `
                <tr>
                    <td>${guest.firstName} ${guest.lastName}</td>
                    <td>${guest.email}</td>
                    <td>${guest.phone}</td>
                    <td><span class="badge bg-${getGuestTypeColor(guest.guestType)}">${guest.guestType.toUpperCase()}</span></td>
                    <td>${guest.totalStays}</td>
                    <td>${guest.lastVisit}</td>
                    <td>${guest.loyaltyPoints} pts</td>
                    <td>
                        <button class="btn btn-sm btn-info me-1" onclick="viewGuest(${guest.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-primary me-1" onclick="editGuest(${guest.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteGuest(${guest.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getGuestTypeColor(type) {
            const colors = {
                'regular': 'secondary',
                'vip': 'warning',
                'corporate': 'info',
                'group': 'success'
            };
            return colors[type] || 'secondary';
        }

        function updateGuestStatistics() {
            const guests = JSON.parse(localStorage.getItem('hotelGuests') || '[]');
            const reservations = JSON.parse(localStorage.getItem('hotelReservations') || '[]');
            
            document.getElementById('totalGuests').textContent = guests.length;
            document.getElementById('vipGuests').textContent = guests.filter(g => g.guestType === 'vip').length;
            
            // Count active stays from reservations
            const currentDate = new Date().toISOString().split('T')[0];
            const activeStays = reservations.filter(r => 
                r.status === 'confirmed' && 
                r.checkIn <= currentDate && 
                r.checkOut >= currentDate
            ).length;
            document.getElementById('activeStays').textContent = activeStays;
            
            // Count returning guests (guests with more than 1 stay)
            const returningGuests = guests.filter(g => g.totalStays > 1).length;
            document.getElementById('returningGuests').textContent = returningGuests;
        }

        function initializeGuestManagement() {
            // Search functionality
            document.getElementById('searchGuests').addEventListener('input', function(e) {
                filterGuests();
            });

            // Guest type filter
            document.getElementById('filterGuestType').addEventListener('change', function(e) {
                filterGuests();
            });
        }

        function filterGuests() {
            const searchTerm = document.getElementById('searchGuests').value.toLowerCase();
            const typeFilter = document.getElementById('filterGuestType').value;
            const guests = JSON.parse(localStorage.getItem('hotelGuests') || '[]');

            let filteredGuests = guests.filter(guest => {
                const fullName = `${guest.firstName} ${guest.lastName}`.toLowerCase();
                const matchesSearch = fullName.includes(searchTerm) ||
                                    guest.email.toLowerCase().includes(searchTerm) ||
                                    guest.phone.toLowerCase().includes(searchTerm);
                
                const matchesType = !typeFilter || guest.guestType === typeFilter;

                return matchesSearch && matchesType;
            });

            const tbody = document.getElementById('guestsTableBody');
            tbody.innerHTML = filteredGuests.map(guest => `
                <tr>
                    <td>${guest.firstName} ${guest.lastName}</td>
                    <td>${guest.email}</td>
                    <td>${guest.phone}</td>
                    <td><span class="badge bg-${getGuestTypeColor(guest.guestType)}">${guest.guestType.toUpperCase()}</span></td>
                    <td>${guest.totalStays}</td>
                    <td>${guest.lastVisit}</td>
                    <td>${guest.loyaltyPoints} pts</td>
                    <td>
                        <button class="btn btn-sm btn-info me-1" onclick="viewGuest(${guest.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-primary me-1" onclick="editGuest(${guest.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteGuest(${guest.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function addGuest() {
            const form = document.getElementById('addGuestForm');
            
            const newGuest = {
                id: Date.now(),
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                guestType: document.getElementById('guestType').value,
                nationality: document.getElementById('nationality').value,
                dateOfBirth: document.getElementById('dateOfBirth').value,
                idNumber: document.getElementById('idNumber').value,
                address: document.getElementById('address').value,
                preferences: document.getElementById('preferences').value,
                notes: document.getElementById('notes').value,
                totalStays: 0,
                loyaltyPoints: 0,
                totalSpent: 0,
                firstVisit: null,
                lastVisit: null,
                registrationDate: new Date().toISOString().split('T')[0]
            };

            const guests = JSON.parse(localStorage.getItem('hotelGuests') || '[]');
            guests.push(newGuest);
            localStorage.setItem('hotelGuests', JSON.stringify(guests));

            // Close modal and refresh
            const modal = bootstrap.Modal.getInstance(document.getElementById('addGuestModal'));
            modal.hide();
            form.reset();
            
            renderGuestsTable();
            updateGuestStatistics();
            
            alert('Guest added successfully!');
        }

        function viewGuest(guestId) {
            const guests = JSON.parse(localStorage.getItem('hotelGuests') || '[]');
            const guest = guests.find(g => g.id === guestId);
            
            if (guest) {
                // Populate guest information
                document.getElementById('viewGuestName').textContent = `${guest.firstName} ${guest.lastName}`;
                document.getElementById('viewGuestEmail').textContent = guest.email;
                document.getElementById('viewGuestPhone').textContent = guest.phone;
                document.getElementById('viewGuestType').innerHTML = `<span class="badge bg-${getGuestTypeColor(guest.guestType)}">${guest.guestType.toUpperCase()}</span>`;
                document.getElementById('viewGuestNationality').textContent = guest.nationality || 'N/A';
                document.getElementById('viewGuestDOB').textContent = guest.dateOfBirth || 'N/A';
                document.getElementById('viewGuestID').textContent = guest.idNumber || 'N/A';
                document.getElementById('viewGuestStays').textContent = guest.totalStays;
                document.getElementById('viewGuestPoints').textContent = guest.loyaltyPoints;
                document.getElementById('viewGuestSpent').textContent = guest.totalSpent ? `IDR ${guest.totalSpent.toLocaleString()}` : 'IDR 0';
                document.getElementById('viewGuestFirstVisit').textContent = guest.firstVisit || 'Never';
                document.getElementById('viewGuestLastVisit').textContent = guest.lastVisit || 'Never';
                document.getElementById('viewGuestAddress').textContent = guest.address || 'N/A';
                document.getElementById('viewGuestPreferences').textContent = guest.preferences || 'None specified';
                document.getElementById('viewGuestNotes').textContent = guest.notes || 'No notes';

                // Load booking history
                loadGuestBookingHistory(guestId);

                const modal = new bootstrap.Modal(document.getElementById('viewGuestModal'));
                modal.show();
            }
        }

        function loadGuestBookingHistory(guestId) {
            const reservations = JSON.parse(localStorage.getItem('hotelReservations') || '[]');
            const guestReservations = reservations.filter(r => r.guestId === guestId);
            
            const historyContainer = document.getElementById('guestBookingHistory');
            
            if (guestReservations.length === 0) {
                historyContainer.innerHTML = '<p class="text-muted">No booking history found.</p>';
                return;
            }

            historyContainer.innerHTML = `
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Reservation ID</th>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Room</th>
                                <th>Status</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${guestReservations.map(res => `
                                <tr>
                                    <td>${res.reservationId}</td>
                                    <td>${res.checkIn}</td>
                                    <td>${res.checkOut}</td>
                                    <td>${res.roomType}</td>
                                    <td><span class="badge bg-${res.status === 'confirmed' ? 'success' : 'secondary'}">${res.status}</span></td>
                                    <td>IDR ${res.totalAmount.toLocaleString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function editGuest(guestId) {
            // This would open an edit modal similar to add guest modal
            // For now, just show an alert
            alert('Edit guest functionality would be implemented here');
        }

        function deleteGuest(guestId) {
            if (confirm('Are you sure you want to delete this guest? This action cannot be undone.')) {
                const guests = JSON.parse(localStorage.getItem('hotelGuests') || '[]');
                const filteredGuests = guests.filter(g => g.id !== guestId);
                localStorage.setItem('hotelGuests', JSON.stringify(filteredGuests));
                
                renderGuestsTable();
                updateGuestStatistics();
                
                alert('Guest deleted successfully!');
            }
        }
    </script>
</body>
</html>
